var listomajors = [
    { 
         "name": "Aerospace Engineering", 
         "link": "http://web.mit.edu/aeroastro/", 
         "course": "16 & 16-ENG", 
         "ismajor": "1", 
         "isminor": "0", 
         "pdf-link": "http://mitadmissions.org/mit-docs/16-AeroAstro-2014-2.pdf", 
    }, 
    { 
             "name": "African and African Diaspora Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary/minors/african", 
             "course": "21", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "American Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary/majors/american", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Ancient and Medieval Studies", 
             "link": "http://ams.scripts.mit.edu/", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Anthropology", 
             "link": "http://web.mit.edu/anthropology/", 
             "course": "21A", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21A-Anthropology(2012).pdf", 
    }, 
    { 
             "name": "Applied International Studies", 
             "link": "http://web.mit.edu/polisci/undergraduate/minor/ais.html", 
             "course": "17", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Archaeology and Materials", 
             "link": "http://web.mit.edu/cmrae/archmat/bs.html", 
             "course": "3-C", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/03-MaterialsSciEng(2012).pdf", 
    }, 
    { 
             "name": "Architecture", 
             "link": "http://architecture.mit.edu/", 
             "course": "4", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/04-Architecture(2014).pdf", 
    }, 
    { 
             "name": "Architecture Studies", 
             "link": "http://architecture.mit.edu/", 
             "course": "4-B", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/04-Architecture(2014).pdf", 
    }, 
    { 
             "name": "Art, Culture and Technology", 
             "link": "http://visualarts.mit.edu/about/undergrad_program.html", 
             "course": "4", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/04-Architecture(2014).pdf", 
    }, 
    { 
             "name": "Asian and Asian Diaspora Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Astronomy", 
             "link": "http://web.mit.edu/astronomy/", 
             "course": "8 or 12", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Atmospheric Chemistry", 
             "link": "http://atmoschem.mit.edu/education/undergraduate/", 
             "course": "12", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Biological Engineering", 
             "link": "http://web.mit.edu/be/index.shtml", 
             "course": "20", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/20-BiologicalEngineering(2012).pdf", 
    }, 
    { 
             "name": "Biology", 
             "link": "http://web.mit.edu/biology/www/", 
             "course": "7 & 7-A", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/07-Biology(2012).pdf", 
    }, 
    { 
             "name": "Biomedical Engineering", 
             "link": "http://be.mit.edu/academic-programs/current-undergraduate/minor-programs", 
             "course": "20", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/BME-BiomedicalEngineering(2012).pdf", 
    }, 
    { 
             "name": "Brain and Cognitive Sciences", 
             "link": "http://bcs.mit.edu/", 
             "course": "9", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/09-BrainCog(2014).pdf", 
    }, 
    { 
             "name": "Business Analytics", 
             "link": "http://mitsloan.mit.edu/undergrad/15-2-business-analytics/", 
             "course": "15-2", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/MIT_Admissions_Majors_and_Minors_Fact_Sheet_-_Course_15_2016.pdf", 
    }, 
    { 
             "name": "Chemical Engineering", 
             "link": "http://web.mit.edu/cheme/", 
             "course": "10 & 10-C & 10-ENG", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/10-ChemicalEngineering(2013).pdf", 
    }, 
    { 
             "name": "Chemical-Biological Engineering", 
             "link": "http://web.mit.edu/cheme/research/areas/biological.html", 
             "course": "10-B", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/10-ChemicalEngineering(2013).pdf", 
    }, 
    { 
             "name": "Chemistry", 
             "link": "http://web.mit.edu/chemistry/www/", 
             "course": "5", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/05-Chemistry(2012).pdf", 
    }, 
    { 
             "name": "Chinese", 
             "link": "http://mitgsl.mit.edu/language/chinese", 
             "course": "21", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Civil and Environmental Engineering", 
             "link": "http://student.mit.edu/catalog/m1a.html", 
             "course": "1-ENG", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/01-CivilEnvironmental(2016).pdf", 
    }, 
    { 
             "name": "Civil and Environmental Systems", 
             "link": "http://student.mit.edu/catalog/m1a.html", 
             "course": "1", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Civil Engineering", 
             "link": "http://student.mit.edu/catalog/m1a.html", 
             "course": "1", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Comparative Media Studies", 
             "link": "http://cmsw.mit.edu/", 
             "course": "CMS", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Computer Science and Engineering", 
             "link": "http://www.eecs.mit.edu/academics-admissions/undergraduate-programs/course-6-3-computer-science-and-engineering", 
             "course": "CS&E/6-3", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/06-EECS(2012).pdf", 
    }, 
    { 
             "name": "Computer Science and Molecular Biology", 
             "link": "http://www.eecs.mit.edu/ug/index.html", 
             "course": "6-7", 
             "ismajor": "1", 
             "isminor": "0", 
    }, 
    { 
             "name": "Design", 
             "link": "https://architecture.mit.edu/overview/undergraduate-degrees", 
             "course": "4", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Earth, Atmospheric and Planetary Sciences", 
             "link": "http://eapsweb.mit.edu/", 
             "course": "12", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/12-EAPS(2012).pdf", 
    }, 
    { 
             "name": "Economics", 
             "link": "http://econ-www.mit.edu/", 
             "course": "14", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/14-Economics(2012).pdf", 
    }, 
    { 
             "name": "Electrical Engineering and Computer Science", 
             "link": "http://www.eecs.mit.edu/ug/index.html", 
             "course": "6-2", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/06-EECS(2012).pdf", 
    }, 
    { 
             "name": "Electrical Science and Engineering", 
             "link": "http://www.eecs.mit.edu/ug/index.html", 
             "course": "6-1", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/06-EECS(2012).pdf", 
    }, 
    { 
             "name": "Energy Studies", 
             "link": "http://web.mit.edu/mitei/education/minor.html", 
             "course": "12", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/Energy(2011).pdf", 
    }, 
    { 
             "name": "Entrepreneurship & Innovation", 
             "link": "http://innovation.mit.edu/education-practice/eiminor/", 
             "course": "E&I", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Environmental Engineering Science", 
             "link": "http://student.mit.edu/catalog/m1a.html", 
             "course": "1", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Finance", 
             "link": "http://mitsloan.mit.edu/undergrad/15-3-finance/", 
             "course": "15-3", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/MIT_Admissions_Majors_and_Minors_Fact_Sheet_-_Course_15_2016.pdf", 
    }, 
    { 
             "name": "French", 
             "link": "http://mitgsl.mit.edu/language/french", 
             "course": "21G", 
             "ismajor": "1", 
             "isminor": "1", 
    }, 
    { 
             "name": "German", 
             "link": "http://mitgsl.mit.edu/language/german", 
             "course": "21G", 
             "ismajor": "1", 
             "isminor": "1", 
    }, 
    { 
             "name": "History", 
             "link": "http://history.mit.edu/", 
             "course": "21H", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21H-History(2012).pdf", 
    }, 
    { 
             "name": "History of Architecture and Art", 
             "link": "http://architecture.mit.edu/", 
             "course": "4", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/04-Architecture(2014).pdf", 
    }, 
    { 
             "name": "Humanities and Engineering", 
             "link": "http://shass.mit.edu/undergraduate/joint", 
             "course": "21E", 
             "isminor": "0", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Humanities and Science", 
             "link": "http://shass.mit.edu/undergraduate/joint", 
             "course": "21S", 
             "isminor": "0", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "International Development", 
             "link": "http://dusp.mit.edu/degrees/undergraduate", 
             "course": "11", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Japanese", 
             "link": "http://mitgsl.mit.edu/language/japanese", 
             "course": "21G", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21F-ForeignLangLit(2012).pdf", 
    }, 
    { 
             "name": "Latin American and Latino Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Linguistics and Philosophy", 
             "link": "http://web.mit.edu/philosophy/", 
             "course": "24-2", 
             "ismajor": "1", 
                      "pdf-link": "http://mitadmissions.org/mit-docs/24-Linguistics(2012).pdf", 
    }, 
    { 
             "name": "Literature", 
             "link": "http://lit.mit.edu/", 
             "course": "21L", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21L-Literature(2010).pdf", 
    }, 
    { 
             "name": "Management", 
             "link": "http://mitsloan.mit.edu/undergrad", 
             "course": "15-1", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/15-Management(2012).pdf", 
    }, 
    { 
             "name": "Materials Science and Engineering", 
             "link": "http://dmse.mit.edu/", 
             "course": "3 & 3-A", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/03-MaterialsSciEng(2012).pdf", 
    }, 
    { 
             "name": "Mathematical Economics", 
             "link": "http://economics.mit.edu/under/majors", 
             "course": "14-2", 
             "ismajor": "1", 
             "isminor": "0", 
    }, 
    { 
             "name": "Mathematics", 
             "link": "http://www-math.mit.edu/", 
             "course": "18", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/18-Math(2012).pdf", 
    }, 
    { 
             "name": "Mathematics with Computer Science", 
             "link": "http://www-math.mit.edu/academics/undergrad/major/course18c.html", 
             "course": "18-C", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/18-Math(2012).pdf", 
    }, 
    { 
             "name": "Mechanical Engineering", 
             "link": "http://meche.mit.edu/", 
             "course": "2 & 2-A", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/02-MechanicalEngineering(2014).pdf", 
    }, 
    { 
             "name": "Mechanical and Ocean Engineering", 
             "link": "http://meche.mit.edu/", 
             "course": "2-OE", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/02-MechanicalEngineering(2014).pdf", 
    }, 
    { 
             "name": "Middle Eastern Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary/minors/middle-eastern", 
             "course": "21", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Music", 
             "link": "http://web.mit.edu/music/", 
             "course": "21M", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21M-Music(2012).pdf", 
    }, 
    { 
             "name": "Nuclear Science & Engineering", 
             "link": "http://web.mit.edu/nse/", 
             "course": "22", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/22-NSE(2014).pdf", 
    }, 
    { 
             "name": "Philosophy", 
             "link": "http://web.mit.edu/philos/www/", 
             "course": "24-1", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/24-Linguistics(2012).pdf", 
    }, 
    { 
             "name": "Physics", 
             "link": "http://web.mit.edu/physics/", 
             "course": "8", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/08-Physics(2009).pdf", 
    }, 
    { 
             "name": "Planning", 
             "link": "http://dusp.mit.edu/", 
             "course": "11", 
             "ismajor": "1", 
             "isminor": "0", 
             "pdf-link": "http://mitadmissions.org/mit-docs/11-UrbanStudies(2012).pdf", 
    }, 
    { 
             "name": "Political Science", 
             "link": "http://web.mit.edu/polisci/", 
             "course": "17", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/17-PoliticalScience(2012).pdf", 
    }, 
    { 
             "name": "Public Policy", 
             "link": "http://web.mit.edu/polisci/undergraduate/minor/pp.html", 
             "course": "17", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Russian and Eurasian Studies", 
             "link": "http://shass.mit.edu/undergraduate/interdisciplinary", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "null" 
    }, 
    { 
             "name": "Science, Technology and Society", 
             "link": "http://web.mit.edu/sts/", 
             "course": "STS", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/STS(2010).pdf", 
    }, 
    { 
             "name": "Spanish", 
             "link": "http://mitgsl.mit.edu/language/spanish", 
             "course": "21G", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21F-ForeignLangLit(2012).pdf", 
    }, 
    { 
             "name": "Statistics and Data Science", 
             "link": "https://stat.mit.edu/", 
             "course": "IDSS", 
             "ismajor": "0", 
             "isminor": "1", 
    }, 
    { 
             "name": "Theater Arts", 
             "link": "http://theaterarts.mit.edu/", 
             "course": "21M", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/Arts(2011).pdf", 
    }, 
    { 
             "name": "Toxicology and Environmental Health", 
             "link": "http://be.mit.edu/academic-programs/current-undergraduate/minor-programs", 
             "course": "20", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/20-BiologicalEngineering(2012).pdf", 
    }, 
    { 
             "name": "Urban Studies and Planning", 
             "link": "http://dusp.mit.edu/", 
             "course": "11", 
             "ismajor": "0", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/11-UrbanStudies(2012).pdf", 
    }, 
    { 
             "name": "Women's and Gender Studies", 
             "link": "http://wgs.mit.edu/degree-requirements", 
             "course": "21", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/WGS(2011).pdf", 
    }, 
    { 
             "name": "Writing", 
             "link": "http://cmsw.mit.edu/education/writing/undergraduate/", 
             "course": "21W", 
             "ismajor": "1", 
             "isminor": "1", 
             "pdf-link": "http://mitadmissions.org/mit-docs/21W-WritingHumanistic(2012).pdf", 
    }
]

'use strict'

var Config = require('./config')
var wit = require('./services/wit').getWit()

// LETS SAVE USER SESSIONS
var sessions = {}

var findOrCreateSession = function (fbid) {
  var sessionId

  // DOES USER SESSION ALREADY EXIST?
  Object.keys(sessions).forEach(k => {
    if (sessions[k].fbid === fbid) {
      // YUP
      sessionId = k
    }
  })

  // No session so we will create one
  if (!sessionId) {
    sessionId = new Date().toISOString()
    sessions[sessionId] = {
      fbid: fbid,
      context: {
        _fbid_: fbid
      }
    }
  }

  return sessionId
}

var read = function (sender, message, reply) {
    if((message.toLowerCase().indexOf('hello') > -1) || (message.toLowerCase().indexOf('hi') > -1) || (message.toLowerCase().indexOf('hey') > -1) || (message.toLowerCase().indexOf('yo') > -1) || (message.toLowerCase().indexOf('heyo') > -1)) {
		message += "Hi! I'm MIT's Admissions chatbot. You can ask me anything you'd like to know about MIT!"
		reply(sender, message)
	} 
    else if ((message.toLowerCase().indexOf('major') > -1) || (message.toLowerCase().indexOf('course') > -1) || (message.toLowerCase().indexOf('concentration') > -1) || (message.toLowerCase().indexOf('department') > -1) || (message.toLowerCase().indexOf('dept') > -1)) {
        for (var amajor in listomajors)
            {
                if (listomajors.hasOwnProperty(amajor)) {
                    var majorwords = listomajors[amajor].name.toString().toLowerCase().split(" ")
                    for(var i = 0; i < majorwords.length; i++) {
                        if (message.toLowerCase().indexOf(majorwords[i]) > -1){
                            var ha = listomajors[amajor].name.toString() + ", or, Course " + listomajors[amajor].course.toString() + ", "
                            if ((listomajors[amajor].ismajor.toString() == "1") && (listomajors[amajor].isminor.toString() == "1")) {
                                ha += "is offered as a both a major and a minor."
                            }
                            else if (listomajors[amajor].ismajor.toString() == "1") {
                                ha += "is only offered as a major."
                            }
                            else if (listomajors[amajor].isminor.toString() == "1") {
                                ha += "is only offered as a minor."
                            }
                            ha += " If you'd like to learn more, you can visit the dept. site at " + listomajors[amajor].link.toString()
                            
                            if (listomajors[amajor]["pdf-link"].toString() != "null") {
                            ha += ", or view the requirements PDF at " + listomajors[amajor]["pdf-link"].toString() + "."
                            }
                            reply(sender, ha)
                        }
                    }
                }
            }
    }
    else {
		// Let's find the user
		var sessionId = findOrCreateSession(sender)
		// Let's forward the message to the Wit.ai bot engine
		// This will run all actions until there are no more actions left to do
		wit.runActions(
			sessionId, // the user's current session by id
			message,  // the user's message
			sessions[sessionId].context, // the user's session state
			function (error, context) { // callback
			if (error) {
				console.log('oops!', error)
			} else {
				// Wit.ai ran all the actions
				// Now it needs more messages
				console.log('Waiting for further messages')

				// Based on the session state, you might want to reset the session
				// Example:
				// if (context['done']) {
				// 	delete sessions[sessionId]
				// }

				// Updating the user's current session state
				sessions[sessionId].context = context
			}
		})
	}
}



module.exports = {
	findOrCreateSession: findOrCreateSession,
	read: read,
}